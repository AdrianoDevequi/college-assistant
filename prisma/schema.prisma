generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  ADMIN
}

enum Level {
  A1
  A2
  B1
  B2
  C1
  C2
}

model User {
  id        String   @id @default(uuid())
  name      String?
  email     String   @unique
  password  String   // Hashed
  role      Role     @default(STUDENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  studentProfile StudentProfile?
  assignedTasks  StudentTask[]

  @@map("user") // Map to lowercase table
}

model StudentProfile {
  id          String @id @default(uuid())
  userId      String @unique
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  phone       String // For WhatsApp integration
  level       Level  @default(A1)
  interestArea String? // e.g. "Agronomia", "Business"

  @@map("studentprofile") // Map to lowercase table
}

model Task {
  id           String @id @default(uuid())
  theme        String // e.g. "Agronomia"
  targetLevel  Level
  content      String @db.Text // JSON or Markdown content from Gemini
  generatedAt  DateTime @default(now())
  
  assignments  StudentTask[]

  @@map("task") // Map to lowercase table
}

model StudentTask {
  id        String   @id @default(uuid())
  studentId String
  student   User     @relation(fields: [studentId], references: [id])
  taskId    String
  task      Task     @relation(fields: [taskId], references: [id])
  
  status    String   @default("PENDING") // PENDING, COMPLETED
  answers   String?  @db.Text // JSON of student answers
  sentAt    DateTime @default(now())
  completedAt DateTime?

  @@map("studenttask") // Map to lowercase table
}

model SystemSettings {
  key   String @id
  value String @db.Text

  @@map("systemsettings") // Map to lowercase table
}

model TaskAutomation {
  id        String   @id @default(uuid())
  theme     String
  level     Level
  frequency String   @default("WEEKLY") // Currently only WEEKLY
  dayOfWeek Int      @default(1) // 0=Sunday, 1=Monday, etc.
  timeOfDay String   @default("09:00") // HH:mm format
  nextRun   DateTime @default(now())
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("taskautomation") // Map to lowercase table
}
